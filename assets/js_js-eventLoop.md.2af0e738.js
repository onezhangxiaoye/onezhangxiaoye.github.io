import{_ as s,o as n,c as a,a as l}from"./app.b90595f9.js";const C=JSON.parse('{"title":"js-eventLoop","description":"","frontmatter":{},"headers":[{"level":2,"title":"åŠ¨æœº","slug":"åŠ¨æœº","link":"#åŠ¨æœº","children":[]},{"level":2,"title":"ä¾‹å­çš„è§£é‡Š","slug":"ä¾‹å­çš„è§£é‡Š","link":"#ä¾‹å­çš„è§£é‡Š","children":[]},{"level":2,"title":"æ—¥å¿—è§£æ","slug":"æ—¥å¿—è§£æ","link":"#æ—¥å¿—è§£æ","children":[]},{"level":2,"title":"ä¾‹å­æºç ","slug":"ä¾‹å­æºç ","link":"#ä¾‹å­æºç ","children":[]}],"relativePath":"js/js-eventLoop.md","lastUpdated":1716447218000}'),p={name:"js/js-eventLoop.md"},o=l(`<h1 id="js-eventloop" tabindex="-1">js-eventLoop <a class="header-anchor" href="#js-eventloop" aria-hidden="true">#</a></h1><ul><li>å‚ç…§</li><li><a href="https://mp.weixin.qq.com/s/l9pGe7-xY08DeaFMnk0xuA" target="_blank" rel="noreferrer">ssh æ·±å…¥è§£æ EventLoop å’Œæµè§ˆå™¨æ¸²æŸ“ã€å¸§åŠ¨ç”»ã€ç©ºé—²å›è°ƒçš„å…³ç³»</a></li><li><a href="https://segmentfault.com/a/1190000008589736" target="_blank" rel="noreferrer">Vueæºç è¯¦è§£ä¹‹nextTickï¼šMutationObserveråªæ˜¯æµ®äº‘ï¼Œmicrotaskæ‰æ˜¯æ ¸å¿ƒï¼</a></li></ul><h2 id="åŠ¨æœº" tabindex="-1">åŠ¨æœº <a class="header-anchor" href="#åŠ¨æœº" aria-hidden="true">#</a></h2><p>å†™äº†ä¸€ä¸ªå°æµ‹è¯•ä»£ç ï¼Œæ¥ä½“ç° <code>å®ä»»åŠ¡ï¼ˆUIäº‹ä»¶ï¼ŒsetTimeoutï¼‰</code>ï¼Œ<code>å¾®ä»»åŠ¡(promise)</code>ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame" target="_blank" rel="noreferrer">requestAnimationFrame</a>(æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨)ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback" target="_blank" rel="noreferrer">requestIdleCallback</a>(æµè§ˆå™¨ç©ºé—²æ—¶æœŸè¢«è°ƒç”¨)ï¼Œçš„æ‰§è¡Œé¡ºåº</p><p>å†™è¿™ä¸ªé—®é¢˜çš„æ¥æºæ˜¯å…³äº <code>vue</code> çš„ <code>$nextTick</code> ä¸ºä»€ä¹ˆæœ€ä¼˜å…ˆä½¿ç”¨ <code>Promise</code> ï¼Œ è€Œæœ€åçš„å…œåº•æ–¹æ¡ˆæ‰æ˜¯ <code>setTimeout</code> ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªå®é™…çš„é—®é¢˜æ˜¯ä¸‹é¢ä¸¤ä¸ªä¾‹å­ï¼Œä¸ºä»€ä¹ˆ <code>setTimeout</code> å®ç°çš„ <code>$nextTick</code> çš„æ–¹å—åœ¨æ»šåŠ¨æ¡æ»šåŠ¨æ—¶ä¼šå‡ºç° <strong>æŠ–åŠ¨</strong></p><p><a href="https://codepen.io/onezhangxiaoye/pen/poNYQVY" target="_blank" rel="noreferrer">$nextTick-promiseå®ç°-CodePen</a></p><p><a href="https://codepen.io/onezhangxiaoye/pen/GRNewQM" target="_blank" rel="noreferrer">$nextTick-setTimeoutå®ç°-CodePen</a></p><h2 id="ä¾‹å­çš„è§£é‡Š" tabindex="-1">ä¾‹å­çš„è§£é‡Š <a class="header-anchor" href="#ä¾‹å­çš„è§£é‡Š" aria-hidden="true">#</a></h2><p><a href="https://cai12317.gitee.io/vite-vue-app-2021-01-13/#/event-loop-test" target="_blank" rel="noreferrer">åœ¨çº¿æµ‹è¯•åœ°å€-event-loop-test</a></p><p>ä¾‹å­æ˜¯åŸºäº Vue3.0 å¼€å‘çš„</p><ol><li>åœ¨ç»„ä»¶åˆå§‹åŒ–æ—¶ï¼Œè®¾ç½®é€’å½’è¿›è¡Œçš„ <code>requestAnimationFrame</code> å’Œ <code>requestIdleCallback</code>ï¼Œåœ¨æ¯æ¬¡å›è°ƒæ‰§è¡Œæ—¶è¾“å‡ºæ—¥å¿—ä¿¡æ¯</li><li>åœ¨å…¶ä¸­ä¸€ä¸ª <code>dom</code> ä¸Šç»‘å®šäº† <code>scroll</code> äº‹ä»¶</li><li>åœ¨ <code>scroll</code> äº‹ä»¶æ‰§è¡Œæ—¶è¾“å‡ºæ—¥å¿—</li><li>è®¾ç½®ä¸€ä¸ª <code>Promise</code> ï¼Œåœ¨ <code>then</code> çš„å›è°ƒä¸­è¾“å‡ºæ—¥å¿—</li><li>åœ¨è®¾ç½® <code>Promise</code> åï¼Œå†æ¬¡è¾“å‡ºæ—¥å¿—</li><li>åœ¨æœ€åï¼Œè®¾ç½®ä¸¤ä¸ªå®ä»»åŠ¡ <code>setTimeout</code> ï¼Œç­‰å¾…æ—¶é—´å‡ä¸è®¾ç½®ï¼Œåœ¨ä¸¤ä¸ª <code>setTimeout</code> è¾“å‡ºä¸åŒçš„æ—¥å¿—</li><li>åœ¨ç•Œé¢ä¸­æ»šåŠ¨æ»šåŠ¨æ¡ï¼Œç„¶åæŸ¥çœ‹æ—¥å¿—è¾“å‡ºæƒ…å†µï¼Œåˆ¤æ–­å¯¹åº”çš„æ‰§è¡Œé¡ºåº</li></ol><h2 id="æ—¥å¿—è§£æ" tabindex="-1">æ—¥å¿—è§£æ <a class="header-anchor" href="#æ—¥å¿—è§£æ" aria-hidden="true">#</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>è¿™æ˜¯ scroll äº‹ä»¶æ‰§è¡Œçš„å®Œæ•´ä»£ç ï¼Œä¸»è¦çš„æ—¥å¿—è¾“å‡ºä½ç½®</p></div><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">scroll</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">count</span><span style="color:#89DDFF;">++</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// scroll æ‰§è¡Œæ—¥å¿—è¾“å‡º</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">---scroll---</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// è®¾ç½®ä¸€ä¸ª Promise ï¼Œåœ¨ then çš„å›è°ƒä¸­è¾“å‡ºæ—¥å¿—</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">---Promise---</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// åœ¨è®¾ç½® Promise åï¼Œå†æ¬¡è¾“å‡ºæ—¥å¿—</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">---scroll---after---</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ·»åŠ ä¸¤ä¸ªå®ä»»åŠ¡</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">---setTimeout---1---</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">---setTimeout---2---</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>æ‰“å°çš„æ—¥å¿—å¾ˆå¤šï¼Œåªæˆªå–äº†éƒ¨åˆ†ç”¨ä»¥è¯´æ˜ï¼›å®é™…è¿‡ç¨‹ä¸­ æµè§ˆå™¨åˆ·æ–°ç‡ä¸åŒ(ä¸‹é¢æ—¥å¿—60fps)ï¼Œæ»šåŠ¨æ¡æ»šåŠ¨çš„é€Ÿåº¦ä¸åŒç­‰éƒ½ä¼šé€ æˆæ‰“å°çš„æ—¥å¿—ä¸å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯æ•´ä½“é€»è¾‘æ—¶ä¸€æ ·çš„ï¼›æ—¥å¿—æœ€å‰é¢çš„æ•°å­—è¡¨ç¤ºæ—¥å¿—é‡å¤æ¬¡æ•°ï¼Œæœ€åé¢çš„æ•°å­—æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰</p></div><ul><li><code>3-6è¡Œ</code>ï¼šæ­¤æ—¶é¡µé¢æ²¡æœ‰ä»»ä½•æ“ä½œï¼Œæˆ‘ä»¬å‘ç°å­˜åœ¨ <code>requestAnimationFrame(é‡ç»˜)</code> æ‰§è¡Œäº†ä¸¤æ¬¡æ‰æ‰§è¡Œäº† <code>requestIdleCallback</code>ï¼Œè¯´æ˜å³ä½¿åœ¨æµè§ˆå™¨ç©ºé—²æƒ…å†µä¸‹ï¼Œ<code>requestIdleCallback</code> çš„æ‰§è¡Œé¢‘ç‡å’Œé‡ç»˜éƒ½ä¸ä¸€å®šä¸€è‡´</li><li><code>7-9è¡Œ</code>ï¼šç¬¬ä¸€æ¬¡è§¦å‘ <code>scroll</code> äº‹ä»¶ï¼Œå…ˆæ‰§è¡Œäº†ä¸»ä»£ç ï¼Œä¸»ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­å‘å¾®ä»»åŠ¡é˜Ÿåˆ—æ·»åŠ äº†ä¸€ä¸ªä»»åŠ¡ï¼Œæœ€åæ‰§è¡Œäº†å¾®ä»»åŠ¡ï¼Œåœ¨è¿™ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œæµè§ˆå™¨åœ¨ <strong>ç¬¬ä¹è¡Œ</strong> æ‰§è¡Œäº†ä¸€æ¬¡é‡ç»˜</li><li><code>7-18è¡Œ</code>ï¼š<code>scroll</code> äº‹ä»¶è§¦å‘äº†ä¸‰æ¬¡ï¼Œæˆ‘ä»¬åœ¨ <code>scroll</code> å›è°ƒé‡Œé¢è®¾ç½®çš„ <code>setTimeout</code> ï¼Œä¸€ä¸ªéƒ½æ²¡æœ‰æœºä¼šæ‰§è¡Œï¼Œæµè§ˆå™¨æ‰§è¡Œäº†ä¼˜å…ˆçº§æ›´é«˜çš„ <code>scroll</code> äº‹ä»¶ï¼Œ<strong>è‹¥æ˜¯åœ¨ <code>setTimeout</code> ä¸­ä¿®æ”¹æ•°æ®ï¼Œæ„å‘³ç€ä¿®æ”¹åçš„æ•°æ®ä¼šé”™è¿‡è¿™ä¸‰æ¬¡æµè§ˆå™¨é‡ç»˜</strong></li><li><code>19-24è¡Œ</code>ï¼šæ‰§è¡Œä¸¤æ¬¡ <code>setTimeout</code> ï¼Œç„¶åæ‰§è¡Œ <code>scroll</code> äº‹ä»¶ï¼Œç„¶åè¿›è¡Œæµè§ˆå™¨é‡ç»˜</li><li><code>7-87è¡Œ</code>ï¼šæµè§ˆå™¨é‡ç»˜å§‹ç»ˆéƒ½å‘ç”Ÿåœ¨ä¸¤æ¬¡å®ä»»åŠ¡ä¹‹é—´ï¼Œä½†æ˜¯è§†ä¹å§‹ç»ˆåœ¨ UI äº‹ä»¶æ‰§è¡Œå®Œæˆåè¿›è¡Œï¼›å¾®ä»»åŠ¡ä¸€å®šä¼šåœ¨å½“å‰å®ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰§è¡Œå®Œæˆï¼›ç”¨æˆ·æ·»åŠ çš„å®ä»»åŠ¡ <code>setTimeout</code> ä¼˜å…ˆçº§æ¯” UI äº‹ä»¶è§¦å‘çš„å®ä»»åŠ¡ä½ï¼Œ<em>è¿™é‡Œä¸ç¡®å®šçš„æ˜¯ï¼Œ<code> UI äº‹ä»¶å›è°ƒ</code> æ˜¯åœ¨ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢è¢«ä¼˜å…ˆå–å‡ºæ¥äº†ï¼Œè¿˜æ˜¯æœ¬å°±åœ¨é˜Ÿåˆ—ä¸­æ’åœ¨äº†é å‰çš„ä½ç½®</em></li><li><code>87-88è¡Œ</code>ï¼š<code>requestIdleCallback</code> åœ¨ <code>7-87è¡Œ</code> å®Œå…¨æ²¡æœ‰æœºä¼šæ‰§è¡Œ(æµè§ˆå™¨æ²¡æœ‰ç©ºé—²)ï¼Œæœ€ååœ¨æµè§ˆå™¨åˆä¸€æ¬¡æ‰§è¡Œäº†é‡ç»˜ï¼Œç„¶åæ‰æ‰§è¡Œäº† <code>requestIdleCallback</code></li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">// .................å‰é¢çœç•¥äº†ä¸€éƒ¨åˆ†......................</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">2--------requestAnimationFrame--------- </span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestIdleCallback---------</span></span>
<span class="line"><span style="color:#A6ACCD;">1--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestIdleCallback---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---1</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---after---1</span></span>
<span class="line"><span style="color:#A6ACCD;">---Promise---1</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---2</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---after---2</span></span>
<span class="line"><span style="color:#A6ACCD;">---Promise---2</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---3</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---after---3</span></span>
<span class="line"><span style="color:#A6ACCD;">---Promise---3</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---1---1</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---2---1</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---4</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---after---4</span></span>
<span class="line"><span style="color:#A6ACCD;">---Promise---4</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---1---2</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---2---2</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---1---3</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---2---3</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---5</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---after---5</span></span>
<span class="line"><span style="color:#A6ACCD;">---Promise---5</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---1---4</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---2---4</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---6</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---after---6</span></span>
<span class="line"><span style="color:#A6ACCD;">---Promise---6</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---7</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---after---7</span></span>
<span class="line"><span style="color:#A6ACCD;">---Promise---7</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---1---5</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---2---5</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---8</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---after---8</span></span>
<span class="line"><span style="color:#A6ACCD;">---Promise---8</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---1---6</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---2---6</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---1---7</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---2---7</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---9</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---after---9</span></span>
<span class="line"><span style="color:#A6ACCD;">---Promise---9</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">// .................ä¸­é—´çœç•¥äº†ä¸€éƒ¨åˆ†......................</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---1---41</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---2---41</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---46</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---after---46</span></span>
<span class="line"><span style="color:#A6ACCD;">---Promise---46</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---1---42</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---2---42</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---47</span></span>
<span class="line"><span style="color:#A6ACCD;">---scroll---after---47</span></span>
<span class="line"><span style="color:#A6ACCD;">---Promise---47</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---1---43</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---2---43</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---1---44</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---2---44</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---1---45</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---2---45</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---1---46</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---2---46</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---1---47</span></span>
<span class="line"><span style="color:#A6ACCD;">---setTimeout---2---47</span></span>
<span class="line"><span style="color:#A6ACCD;">1--------requestAnimationFrame---------</span></span>
<span class="line"><span style="color:#A6ACCD;">--------requestIdleCallback---------</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">// .................åé¢çœç•¥äº†ä¸€éƒ¨åˆ†......................</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="ä¾‹å­æºç " tabindex="-1">ä¾‹å­æºç  <a class="header-anchor" href="#ä¾‹å­æºç " aria-hidden="true">#</a></h2><details class="details custom-block"><summary>ç‚¹å‡»æŸ¥çœ‹ä»£ç </summary><div class="language-vue"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">event-loop-test</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">@scroll</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scroll</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">event-loop-test-box</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">            æ»šåŠ¨å±å¹•ï¼Œè¿›è¡Œå®éªŒï¼šä¸‹æ–¹å†…å®¹ä¸ºè¾“å‡ºçš„æ—¥å¿—ğŸ‘‡ğŸ‘‡ğŸ‘‡</span></span>
<span class="line"><span style="color:#A6ACCD;">            æœ€å¤§æ—¥å¿—æ¡æ•° {{ maxLogStackLength }}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">event-loop-test-button</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">style</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">right: 20px</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">@click</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">handleClick</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">{{ closeLog ? &#39;å…³é—­&#39; : &#39;æ‰“å¼€&#39; }}æ—¥å¿—è¾“å‡º</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">event-loop-test-button</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">style</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">right: 130px</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">@click</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">clearLog</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">æ¸…ç©ºæ—¥å¿—</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-for</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">(item, i) in logStack</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">:key</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">i</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">{{ item }}</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">reactive</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineComponent</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ref</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineComponent</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">setup</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">count</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">maxLogStackLength</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">500</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">closeLog</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">ref</span><span style="color:#F07178;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">logStack</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">reactive</span><span style="color:#F07178;">([])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">pushLog</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">log</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">closeLog</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">logStack</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">logStack</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">log</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// å–å‡ºæ—¥å¿—çš„æœ€åä¸€æ¡</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lastLog</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">logStack</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">logStack</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">lastLog</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">endsWith</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">log</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">logStack</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">splice</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">logStack</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lastLog</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#C3E88D;">\\d</span><span style="color:#89DDFF;">*/</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">match</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">match</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">logStack</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">maxLogStackLength</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#A6ACCD;">logStack</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">shift</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#A6ACCD;">logStack</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">log</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">log</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">log</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">closeLog</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">pushLog</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">log</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">log</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">onRefresh</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">requestAnimationFrame</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#82AAFF;">onRefresh</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">--------requestAnimationFrame---------</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">myRequestIdleCallback</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">requestIdleCallback</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">--------requestIdleCallback---------</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#82AAFF;">myRequestIdleCallback</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// è®¾ç½® é€’å½’è¿›è¡Œçš„ requestAnimationFrame å’Œ requestIdleCallback</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">onRefresh</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">myRequestIdleCallback</span><span style="color:#F07178;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">scroll</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">count</span><span style="color:#89DDFF;">++</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// scroll æ‰§è¡Œæ—¥å¿—è¾“å‡º</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">---scroll---</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// è®¾ç½®ä¸€ä¸ª Promise ï¼Œåœ¨ then çš„å›è°ƒä¸­è¾“å‡ºæ—¥å¿—</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">---Promise---</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// åœ¨è®¾ç½® Promise åï¼Œå†æ¬¡è¾“å‡ºæ—¥å¿—</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">---scroll---after---</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// æ·»åŠ ä¸¤ä¸ªå®ä»»åŠ¡</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">---setTimeout---1---</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">---setTimeout---2---</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">a</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">handleClick</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">closeLog</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">closeLog</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">clearLog</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">logStack</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">splice</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">logStack</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">scroll</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">closeLog</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">logStack</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">handleClick</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">clearLog</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#A6ACCD;">maxLogStackLength</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">style</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">scoped</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">event-loop-test</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#B2CCD6;">height</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100vh</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#B2CCD6;">overflow</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> auto</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">event-loop-test-box</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#B2CCD6;">height</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">200vh</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">event-loop-test-button</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#B2CCD6;">position</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> fixed</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#B2CCD6;">top</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">20px</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">style</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre></div></details>`,20),e=[o];function t(c,r,F,y,D,i){return n(),a("div",null,e)}const d=s(p,[["render",t]]);export{C as __pageData,d as default};
