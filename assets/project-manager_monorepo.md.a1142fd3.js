import{_ as s,o as n,c as a,a as l}from"./app.b90595f9.js";const F=JSON.parse('{"title":"monorepo","description":"","frontmatter":{},"headers":[{"level":2,"title":"优势","slug":"优势","link":"#优势","children":[]},{"level":2,"title":"缺点","slug":"缺点","link":"#缺点","children":[]},{"level":2,"title":"基于 pnpm 的 monorepo","slug":"基于-pnpm-的-monorepo","link":"#基于-pnpm-的-monorepo","children":[]},{"level":2,"title":"pnpm-workspace.yaml","slug":"pnpm-workspace-yaml","link":"#pnpm-workspace-yaml","children":[]},{"level":2,"title":"项目文件树","slug":"项目文件树","link":"#项目文件树","children":[]},{"level":2,"title":"pnpm-workspace.yaml 文件配置","slug":"pnpm-workspace-yaml-文件配置","link":"#pnpm-workspace-yaml-文件配置","children":[]},{"level":2,"title":"monorepo-test/web/components/button/package.json","slug":"monorepo-test-web-components-button-package-json","link":"#monorepo-test-web-components-button-package-json","children":[]},{"level":2,"title":"本地依赖的安装","slug":"本地依赖的安装","link":"#本地依赖的安装","children":[]}],"relativePath":"project-manager/monorepo.md","lastUpdated":1716447218000}'),p={name:"project-manager/monorepo.md"},o=l(`<h1 id="monorepo" tabindex="-1">monorepo <a class="header-anchor" href="#monorepo" aria-hidden="true">#</a></h1><p><a href="https://en.wikipedia.org/wiki/Monorepo" target="_blank" rel="noreferrer">monorepo</a> 是一种软件开发策略，把多个项目放在同一个仓库下进行管理</p><h2 id="优势" tabindex="-1">优势 <a class="header-anchor" href="#优势" aria-hidden="true">#</a></h2><ul><li>易于代码的重用</li><li>易于依赖管理</li><li>利于跨团队协作</li></ul><h2 id="缺点" tabindex="-1">缺点 <a class="header-anchor" href="#缺点" aria-hidden="true">#</a></h2><ul><li>项目的版本缺失</li><li>缺乏每个项目的权限控制</li><li>默认需要更多的存储空间</li></ul><h2 id="基于-pnpm-的-monorepo" tabindex="-1">基于 pnpm 的 monorepo <a class="header-anchor" href="#基于-pnpm-的-monorepo" aria-hidden="true">#</a></h2><p><a href="https://pnpm.io/zh/" target="_blank" rel="noreferrer">pnpm</a> 快速的，节省磁盘空间的包管理工具。</p><ul><li>节约磁盘空间并提升安装速度 <ul><li>如果你用到了某依赖项的不同版本，只会将不同版本间有差异的文件添加到仓库</li><li>所有文件都会存储在硬盘上的某一位置。 当软件包被被安装时，包里的文件会 <code>硬链接</code> 到这一位置，而不会占用额外的磁盘空间。 这允许你跨项目地共享同一版本的依赖。</li></ul></li><li>创建非扁平化的 <code>node_modules</code> 文件夹 <ul><li>默认情况下，pnpm 使用软链的方式将项目的直接依赖添加进模块文件夹的根目录</li></ul></li></ul><h2 id="pnpm-workspace-yaml" tabindex="-1">pnpm-workspace.yaml <a class="header-anchor" href="#pnpm-workspace-yaml" aria-hidden="true">#</a></h2><p><code>pnpm-workspace.yaml</code> 定义了 工作空间 的根目录，并能够使您从工作空间中包含 / 排除目录 。 默认情况下，包含所有子目录。</p><blockquote><p>即使使用了自定义目录位置通配符，根目录下的package目录也总是被包含</p></blockquote><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F07178;">packages</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;"># 所有包在 packages/ 的直接子目录内</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;"># 所有包在 components/ 的子目录内</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">components/**</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;"># 排除 test 目录中的包</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">!**/test/**</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><h2 id="项目文件树" tabindex="-1">项目文件树 <a class="header-anchor" href="#项目文件树" aria-hidden="true">#</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">- monorepo-test</span></span>
<span class="line"><span style="color:#A6ACCD;">    - client</span></span>
<span class="line"><span style="color:#A6ACCD;">        - v3-demo</span></span>
<span class="line"><span style="color:#A6ACCD;">    - packages</span></span>
<span class="line"><span style="color:#A6ACCD;">        - utils</span></span>
<span class="line"><span style="color:#A6ACCD;">            - array</span></span>
<span class="line"><span style="color:#A6ACCD;">                - index.js</span></span>
<span class="line"><span style="color:#A6ACCD;">                - package.json</span></span>
<span class="line"><span style="color:#A6ACCD;">            - index.js</span></span>
<span class="line"><span style="color:#A6ACCD;">            - package.json</span></span>
<span class="line"><span style="color:#A6ACCD;">    - web</span></span>
<span class="line"><span style="color:#A6ACCD;">        - components</span></span>
<span class="line"><span style="color:#A6ACCD;">            - button</span></span>
<span class="line"><span style="color:#A6ACCD;">                - index.js</span></span>
<span class="line"><span style="color:#A6ACCD;">                - package.json</span></span>
<span class="line"><span style="color:#A6ACCD;">            - index.js</span></span>
<span class="line"><span style="color:#A6ACCD;">            - package.json</span></span>
<span class="line"><span style="color:#A6ACCD;">    - package.json</span></span>
<span class="line"><span style="color:#A6ACCD;">    - pnpm-workspace.yaml</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="pnpm-workspace-yaml-文件配置" tabindex="-1">pnpm-workspace.yaml 文件配置 <a class="header-anchor" href="#pnpm-workspace-yaml-文件配置" aria-hidden="true">#</a></h2><ul><li><code>packages/*</code> 和 <code>packages/**</code> 的区别 <ul><li><code>packages/*</code> 他的直接子目录会作为单独的项目进行检测，<strong>比如上面的 <code>packages/utils/array</code> 就不会被检测到</strong></li><li><code>web/**</code> 他下级的所有目录都会作为单独的项目进行检测，<strong>比如上面的 <code>web/components/button</code> 就会被检测到</strong></li></ul></li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">packages:</span></span>
<span class="line"><span style="color:#A6ACCD;">  - &quot;packages/*&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  - &quot;client/*&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  - &quot;web/**&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="monorepo-test-web-components-button-package-json" tabindex="-1">monorepo-test/web/components/button/package.json <a class="header-anchor" href="#monorepo-test-web-components-button-package-json" aria-hidden="true">#</a></h2><ul><li>在 <code>package.json</code> 中有三个比较重要的配置 <ul><li><code>name</code> 这就是安装时包的名称，尽量不使用用文件夹名称，这样容易和第三方的包名冲突，类似 <code>vue3</code> 源码更加倾向于用 <code>@monorepo-test/button</code> 这种方式命名</li><li><code>version</code> 是包的版本</li><li><code>main</code> 引入包的入口</li></ul></li></ul><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@monorepo-test/button</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">main</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">keywords</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[],</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">author</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">license</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ISC</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">dependencies</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">lodash-es</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">^4.17.21</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h2 id="本地依赖的安装" tabindex="-1">本地依赖的安装 <a class="header-anchor" href="#本地依赖的安装" aria-hidden="true">#</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;"># 在根目录安装到指 定package_name 下</span></span>
<span class="line"><span style="color:#A6ACCD;">pnpm add &lt;本地 package_name / npm package_name&gt; --filter &lt;安装到此 package_name 下&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># 不使用 --filter/-F 先进入到指定目录</span></span>
<span class="line"><span style="color:#A6ACCD;">pnpm add &lt;本地 package_name / npm package_name&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># 在项目下任意目录安装到根目录下 --workspace/-w</span></span>
<span class="line"><span style="color:#A6ACCD;">pnpm add &lt;npm package_name&gt; -w</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div>`,23),e=[o];function t(c,r,i,D,y,C){return n(),a("div",null,e)}const A=s(p,[["render",t]]);export{F as __pageData,A as default};
