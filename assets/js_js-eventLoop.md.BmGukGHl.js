import{_ as s,c as i,o as a,a1 as n}from"./chunks/framework.DSzkhk7e.js";const o=JSON.parse('{"title":"js-eventLoop","description":"","frontmatter":{},"headers":[],"relativePath":"js/js-eventLoop.md","filePath":"js/js-eventLoop.md","lastUpdated":1716447218000}'),l={name:"js/js-eventLoop.md"},p=n(`<h1 id="js-eventloop" tabindex="-1">js-eventLoop <a class="header-anchor" href="#js-eventloop" aria-label="Permalink to &quot;js-eventLoop&quot;">â€‹</a></h1><ul><li>å‚ç…§</li><li><a href="https://mp.weixin.qq.com/s/l9pGe7-xY08DeaFMnk0xuA" target="_blank" rel="noreferrer">ssh æ·±å…¥è§£æ EventLoop å’Œæµè§ˆå™¨æ¸²æŸ“ã€å¸§åŠ¨ç”»ã€ç©ºé—²å›è°ƒçš„å…³ç³»</a></li><li><a href="https://segmentfault.com/a/1190000008589736" target="_blank" rel="noreferrer">Vueæºç è¯¦è§£ä¹‹nextTickï¼šMutationObserveråªæ˜¯æµ®äº‘ï¼Œmicrotaskæ‰æ˜¯æ ¸å¿ƒï¼</a></li></ul><h2 id="åŠ¨æœº" tabindex="-1">åŠ¨æœº <a class="header-anchor" href="#åŠ¨æœº" aria-label="Permalink to &quot;åŠ¨æœº&quot;">â€‹</a></h2><p>å†™äº†ä¸€ä¸ªå°æµ‹è¯•ä»£ç ï¼Œæ¥ä½“ç° <code>å®ä»»åŠ¡ï¼ˆUIäº‹ä»¶ï¼ŒsetTimeoutï¼‰</code>ï¼Œ<code>å¾®ä»»åŠ¡(promise)</code>ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame" target="_blank" rel="noreferrer">requestAnimationFrame</a>(æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨)ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback" target="_blank" rel="noreferrer">requestIdleCallback</a>(æµè§ˆå™¨ç©ºé—²æ—¶æœŸè¢«è°ƒç”¨)ï¼Œçš„æ‰§è¡Œé¡ºåº</p><p>å†™è¿™ä¸ªé—®é¢˜çš„æ¥æºæ˜¯å…³äº <code>vue</code> çš„ <code>$nextTick</code> ä¸ºä»€ä¹ˆæœ€ä¼˜å…ˆä½¿ç”¨ <code>Promise</code> ï¼Œ è€Œæœ€åçš„å…œåº•æ–¹æ¡ˆæ‰æ˜¯ <code>setTimeout</code> ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªå®é™…çš„é—®é¢˜æ˜¯ä¸‹é¢ä¸¤ä¸ªä¾‹å­ï¼Œä¸ºä»€ä¹ˆ <code>setTimeout</code> å®ç°çš„ <code>$nextTick</code> çš„æ–¹å—åœ¨æ»šåŠ¨æ¡æ»šåŠ¨æ—¶ä¼šå‡ºç° <strong>æŠ–åŠ¨</strong></p><p><a href="https://codepen.io/onezhangxiaoye/pen/poNYQVY" target="_blank" rel="noreferrer">$nextTick-promiseå®ç°-CodePen</a></p><p><a href="https://codepen.io/onezhangxiaoye/pen/GRNewQM" target="_blank" rel="noreferrer">$nextTick-setTimeoutå®ç°-CodePen</a></p><h2 id="ä¾‹å­çš„è§£é‡Š" tabindex="-1">ä¾‹å­çš„è§£é‡Š <a class="header-anchor" href="#ä¾‹å­çš„è§£é‡Š" aria-label="Permalink to &quot;ä¾‹å­çš„è§£é‡Š&quot;">â€‹</a></h2><p><a href="https://cai12317.gitee.io/vite-vue-app-2021-01-13/#/event-loop-test" target="_blank" rel="noreferrer">åœ¨çº¿æµ‹è¯•åœ°å€-event-loop-test</a></p><p>ä¾‹å­æ˜¯åŸºäº Vue3.0 å¼€å‘çš„</p><ol><li>åœ¨ç»„ä»¶åˆå§‹åŒ–æ—¶ï¼Œè®¾ç½®é€’å½’è¿›è¡Œçš„ <code>requestAnimationFrame</code> å’Œ <code>requestIdleCallback</code>ï¼Œåœ¨æ¯æ¬¡å›è°ƒæ‰§è¡Œæ—¶è¾“å‡ºæ—¥å¿—ä¿¡æ¯</li><li>åœ¨å…¶ä¸­ä¸€ä¸ª <code>dom</code> ä¸Šç»‘å®šäº† <code>scroll</code> äº‹ä»¶</li><li>åœ¨ <code>scroll</code> äº‹ä»¶æ‰§è¡Œæ—¶è¾“å‡ºæ—¥å¿—</li><li>è®¾ç½®ä¸€ä¸ª <code>Promise</code> ï¼Œåœ¨ <code>then</code> çš„å›è°ƒä¸­è¾“å‡ºæ—¥å¿—</li><li>åœ¨è®¾ç½® <code>Promise</code> åï¼Œå†æ¬¡è¾“å‡ºæ—¥å¿—</li><li>åœ¨æœ€åï¼Œè®¾ç½®ä¸¤ä¸ªå®ä»»åŠ¡ <code>setTimeout</code> ï¼Œç­‰å¾…æ—¶é—´å‡ä¸è®¾ç½®ï¼Œåœ¨ä¸¤ä¸ª <code>setTimeout</code> è¾“å‡ºä¸åŒçš„æ—¥å¿—</li><li>åœ¨ç•Œé¢ä¸­æ»šåŠ¨æ»šåŠ¨æ¡ï¼Œç„¶åæŸ¥çœ‹æ—¥å¿—è¾“å‡ºæƒ…å†µï¼Œåˆ¤æ–­å¯¹åº”çš„æ‰§è¡Œé¡ºåº</li></ol><h2 id="æ—¥å¿—è§£æ" tabindex="-1">æ—¥å¿—è§£æ <a class="header-anchor" href="#æ—¥å¿—è§£æ" aria-label="Permalink to &quot;æ—¥å¿—è§£æ&quot;">â€‹</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>è¿™æ˜¯ scroll äº‹ä»¶æ‰§è¡Œçš„å®Œæ•´ä»£ç ï¼Œä¸»è¦çš„æ—¥å¿—è¾“å‡ºä½ç½®</p></div><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> scroll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> count</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // scroll æ‰§è¡Œæ—¥å¿—è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`---scroll---\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è®¾ç½®ä¸€ä¸ª Promise ï¼Œåœ¨ then çš„å›è°ƒä¸­è¾“å‡ºæ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    resolve.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`---Promise---\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // åœ¨è®¾ç½® Promise åï¼Œå†æ¬¡è¾“å‡ºæ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`---scroll---after---\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // æ·»åŠ ä¸¤ä¸ªå®ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`---setTimeout---1---\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`---setTimeout---2---\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>æ‰“å°çš„æ—¥å¿—å¾ˆå¤šï¼Œåªæˆªå–äº†éƒ¨åˆ†ç”¨ä»¥è¯´æ˜ï¼›å®é™…è¿‡ç¨‹ä¸­ æµè§ˆå™¨åˆ·æ–°ç‡ä¸åŒ(ä¸‹é¢æ—¥å¿—60fps)ï¼Œæ»šåŠ¨æ¡æ»šåŠ¨çš„é€Ÿåº¦ä¸åŒç­‰éƒ½ä¼šé€ æˆæ‰“å°çš„æ—¥å¿—ä¸å®Œå…¨ä¸€æ ·ï¼Œä½†æ˜¯æ•´ä½“é€»è¾‘æ—¶ä¸€æ ·çš„ï¼›æ—¥å¿—æœ€å‰é¢çš„æ•°å­—è¡¨ç¤ºæ—¥å¿—é‡å¤æ¬¡æ•°ï¼Œæœ€åé¢çš„æ•°å­—æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰</p></div><ul><li><code>3-6è¡Œ</code>ï¼šæ­¤æ—¶é¡µé¢æ²¡æœ‰ä»»ä½•æ“ä½œï¼Œæˆ‘ä»¬å‘ç°å­˜åœ¨ <code>requestAnimationFrame(é‡ç»˜)</code> æ‰§è¡Œäº†ä¸¤æ¬¡æ‰æ‰§è¡Œäº† <code>requestIdleCallback</code>ï¼Œè¯´æ˜å³ä½¿åœ¨æµè§ˆå™¨ç©ºé—²æƒ…å†µä¸‹ï¼Œ<code>requestIdleCallback</code> çš„æ‰§è¡Œé¢‘ç‡å’Œé‡ç»˜éƒ½ä¸ä¸€å®šä¸€è‡´</li><li><code>7-9è¡Œ</code>ï¼šç¬¬ä¸€æ¬¡è§¦å‘ <code>scroll</code> äº‹ä»¶ï¼Œå…ˆæ‰§è¡Œäº†ä¸»ä»£ç ï¼Œä¸»ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­å‘å¾®ä»»åŠ¡é˜Ÿåˆ—æ·»åŠ äº†ä¸€ä¸ªä»»åŠ¡ï¼Œæœ€åæ‰§è¡Œäº†å¾®ä»»åŠ¡ï¼Œåœ¨è¿™ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œæµè§ˆå™¨åœ¨ <strong>ç¬¬ä¹è¡Œ</strong> æ‰§è¡Œäº†ä¸€æ¬¡é‡ç»˜</li><li><code>7-18è¡Œ</code>ï¼š<code>scroll</code> äº‹ä»¶è§¦å‘äº†ä¸‰æ¬¡ï¼Œæˆ‘ä»¬åœ¨ <code>scroll</code> å›è°ƒé‡Œé¢è®¾ç½®çš„ <code>setTimeout</code> ï¼Œä¸€ä¸ªéƒ½æ²¡æœ‰æœºä¼šæ‰§è¡Œï¼Œæµè§ˆå™¨æ‰§è¡Œäº†ä¼˜å…ˆçº§æ›´é«˜çš„ <code>scroll</code> äº‹ä»¶ï¼Œ<strong>è‹¥æ˜¯åœ¨ <code>setTimeout</code> ä¸­ä¿®æ”¹æ•°æ®ï¼Œæ„å‘³ç€ä¿®æ”¹åçš„æ•°æ®ä¼šé”™è¿‡è¿™ä¸‰æ¬¡æµè§ˆå™¨é‡ç»˜</strong></li><li><code>19-24è¡Œ</code>ï¼šæ‰§è¡Œä¸¤æ¬¡ <code>setTimeout</code> ï¼Œç„¶åæ‰§è¡Œ <code>scroll</code> äº‹ä»¶ï¼Œç„¶åè¿›è¡Œæµè§ˆå™¨é‡ç»˜</li><li><code>7-87è¡Œ</code>ï¼šæµè§ˆå™¨é‡ç»˜å§‹ç»ˆéƒ½å‘ç”Ÿåœ¨ä¸¤æ¬¡å®ä»»åŠ¡ä¹‹é—´ï¼Œä½†æ˜¯è§†ä¹å§‹ç»ˆåœ¨ UI äº‹ä»¶æ‰§è¡Œå®Œæˆåè¿›è¡Œï¼›å¾®ä»»åŠ¡ä¸€å®šä¼šåœ¨å½“å‰å®ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰§è¡Œå®Œæˆï¼›ç”¨æˆ·æ·»åŠ çš„å®ä»»åŠ¡ <code>setTimeout</code> ä¼˜å…ˆçº§æ¯” UI äº‹ä»¶è§¦å‘çš„å®ä»»åŠ¡ä½ï¼Œ<em>è¿™é‡Œä¸ç¡®å®šçš„æ˜¯ï¼Œ<code> UI äº‹ä»¶å›è°ƒ</code> æ˜¯åœ¨ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢è¢«ä¼˜å…ˆå–å‡ºæ¥äº†ï¼Œè¿˜æ˜¯æœ¬å°±åœ¨é˜Ÿåˆ—ä¸­æ’åœ¨äº†é å‰çš„ä½ç½®</em></li><li><code>87-88è¡Œ</code>ï¼š<code>requestIdleCallback</code> åœ¨ <code>7-87è¡Œ</code> å®Œå…¨æ²¡æœ‰æœºä¼šæ‰§è¡Œ(æµè§ˆå™¨æ²¡æœ‰ç©ºé—²)ï¼Œæœ€ååœ¨æµè§ˆå™¨åˆä¸€æ¬¡æ‰§è¡Œäº†é‡ç»˜ï¼Œç„¶åæ‰æ‰§è¡Œäº† <code>requestIdleCallback</code></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>// .................å‰é¢çœç•¥äº†ä¸€éƒ¨åˆ†......................</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2--------requestAnimationFrame--------- </span></span>
<span class="line"><span>--------requestIdleCallback---------</span></span>
<span class="line"><span>1--------requestAnimationFrame---------</span></span>
<span class="line"><span>--------requestIdleCallback---------</span></span>
<span class="line"><span>---scroll---1</span></span>
<span class="line"><span>---scroll---after---1</span></span>
<span class="line"><span>---Promise---1</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---scroll---2</span></span>
<span class="line"><span>---scroll---after---2</span></span>
<span class="line"><span>---Promise---2</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---scroll---3</span></span>
<span class="line"><span>---scroll---after---3</span></span>
<span class="line"><span>---Promise---3</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---setTimeout---1---1</span></span>
<span class="line"><span>---setTimeout---2---1</span></span>
<span class="line"><span>---scroll---4</span></span>
<span class="line"><span>---scroll---after---4</span></span>
<span class="line"><span>---Promise---4</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---setTimeout---1---2</span></span>
<span class="line"><span>---setTimeout---2---2</span></span>
<span class="line"><span>---setTimeout---1---3</span></span>
<span class="line"><span>---setTimeout---2---3</span></span>
<span class="line"><span>---scroll---5</span></span>
<span class="line"><span>---scroll---after---5</span></span>
<span class="line"><span>---Promise---5</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---setTimeout---1---4</span></span>
<span class="line"><span>---setTimeout---2---4</span></span>
<span class="line"><span>---scroll---6</span></span>
<span class="line"><span>---scroll---after---6</span></span>
<span class="line"><span>---Promise---6</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---scroll---7</span></span>
<span class="line"><span>---scroll---after---7</span></span>
<span class="line"><span>---Promise---7</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---setTimeout---1---5</span></span>
<span class="line"><span>---setTimeout---2---5</span></span>
<span class="line"><span>---scroll---8</span></span>
<span class="line"><span>---scroll---after---8</span></span>
<span class="line"><span>---Promise---8</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---setTimeout---1---6</span></span>
<span class="line"><span>---setTimeout---2---6</span></span>
<span class="line"><span>---setTimeout---1---7</span></span>
<span class="line"><span>---setTimeout---2---7</span></span>
<span class="line"><span>---scroll---9</span></span>
<span class="line"><span>---scroll---after---9</span></span>
<span class="line"><span>---Promise---9</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// .................ä¸­é—´çœç•¥äº†ä¸€éƒ¨åˆ†......................</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---setTimeout---1---41</span></span>
<span class="line"><span>---setTimeout---2---41</span></span>
<span class="line"><span>---scroll---46</span></span>
<span class="line"><span>---scroll---after---46</span></span>
<span class="line"><span>---Promise---46</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---setTimeout---1---42</span></span>
<span class="line"><span>---setTimeout---2---42</span></span>
<span class="line"><span>---scroll---47</span></span>
<span class="line"><span>---scroll---after---47</span></span>
<span class="line"><span>---Promise---47</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---setTimeout---1---43</span></span>
<span class="line"><span>---setTimeout---2---43</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---setTimeout---1---44</span></span>
<span class="line"><span>---setTimeout---2---44</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---setTimeout---1---45</span></span>
<span class="line"><span>---setTimeout---2---45</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---setTimeout---1---46</span></span>
<span class="line"><span>---setTimeout---2---46</span></span>
<span class="line"><span>--------requestAnimationFrame---------</span></span>
<span class="line"><span>---setTimeout---1---47</span></span>
<span class="line"><span>---setTimeout---2---47</span></span>
<span class="line"><span>1--------requestAnimationFrame---------</span></span>
<span class="line"><span>--------requestIdleCallback---------</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// .................åé¢çœç•¥äº†ä¸€éƒ¨åˆ†......................</span></span></code></pre></div><h2 id="ä¾‹å­æºç " tabindex="-1">ä¾‹å­æºç  <a class="header-anchor" href="#ä¾‹å­æºç " aria-label="Permalink to &quot;ä¾‹å­æºç &quot;">â€‹</a></h2><details class="details custom-block"><summary>ç‚¹å‡»æŸ¥çœ‹ä»£ç </summary><div class="language-vue vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;event-loop-test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scroll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scroll</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;event-loop-test-box&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            æ»šåŠ¨å±å¹•ï¼Œè¿›è¡Œå®éªŒï¼šä¸‹æ–¹å†…å®¹ä¸ºè¾“å‡ºçš„æ—¥å¿—ğŸ‘‡ğŸ‘‡ğŸ‘‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            æœ€å¤§æ—¥å¿—æ¡æ•° {{ maxLogStackLength }}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;event-loop-test-button&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">right</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">click</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">handleClick</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{{ closeLog </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;å…³é—­&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;æ‰“å¼€&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }}æ—¥å¿—è¾“å‡º&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> class</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;event-loop-test-button&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">right</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">130</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">click</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clearLog</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;æ¸…ç©ºæ—¥å¿—&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> v-for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(item, i) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> logStack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> :</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{{ item }}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> lang</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {reactive, defineComponent, ref} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineComponent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> count </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> maxLogStackLength</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 500</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> closeLog</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> logStack </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reactive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> pushLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">closeLog.value) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">logStack.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    logStack.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(log)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // å–å‡ºæ—¥å¿—çš„æœ€åä¸€æ¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lastLog </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> logStack[logStack.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (lastLog.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">endsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(log)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    logStack.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">splice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(logStack.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lastLog.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">match</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(match </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(logStack.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> maxLogStackLength) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        logStack.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">shift</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    logStack.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(log)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">closeLog.value) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                pushLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(log)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(log)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onRefresh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                requestAnimationFrame</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    onRefresh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;--------requestAnimationFrame---------&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> myRequestIdleCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">requestIdleCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;--------requestIdleCallback---------&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    myRequestIdleCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // è®¾ç½® é€’å½’è¿›è¡Œçš„ requestAnimationFrame å’Œ requestIdleCallback</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            onRefresh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            myRequestIdleCallback</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> resolve</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> scroll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> count</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // scroll æ‰§è¡Œæ—¥å¿—è¾“å‡º</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`---scroll---\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // è®¾ç½®ä¸€ä¸ª Promise ï¼Œåœ¨ then çš„å›è°ƒä¸­è¾“å‡ºæ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                resolve.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`---Promise---\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // åœ¨è®¾ç½® Promise åï¼Œå†æ¬¡è¾“å‡ºæ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`---scroll---after---\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                // æ·»åŠ ä¸¤ä¸ªå®ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`---setTimeout---1---\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">                    log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`---setTimeout---2---\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> handleClick</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                closeLog.value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">closeLog.value</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> clearLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                logStack.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">splice</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, logStack.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                scroll,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                closeLog,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                logStack,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                handleClick,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                clearLog,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                maxLogStackLength,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">style</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> scoped</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.event-loop-test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">vh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    overflow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">auto</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.event-loop-test-box</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    height</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">vh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">.event-loop-test-button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    position</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">fixed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    top</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">px</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">style</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div></details>`,20),h=[p];function k(t,e,E,r,d,g){return a(),i("div",null,h)}const y=s(l,[["render",k]]);export{o as __pageData,y as default};
